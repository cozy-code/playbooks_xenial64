- name: change SSH port to {{ alt_ssh_port }}
  become: yes
  become_user: root
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    regexp: "^Port"
    line: "Port {{ alt_ssh_port }}"

- name: disable password login
  become: yes
  become_user: root
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    regexp: "^PasswordAuthentication"
    line: "PasswordAuthentication no"

- name: disable root login
  become: yes
  become_user: root
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    regexp: "^PermitRootLogin.*"
    line: "PermitRootLogin no"

- name: sshd restart
  become: yes
  become_user: root
  service: name=sshd state=restarted

- name: set port to {{ alt_ssh_port }}
  set_fact:
    ansible_port: "{{ alt_ssh_port }}"
    available_ssh_port: "{{ alt_ssh_port }}"
